Права на объект есть эффективное и пользовательское.
 — Эффективное однозначно отвечает возможна операция с объектом или нет.
 — Пользовательское — позволяет откат и информирование (интерфейс), при смене прав родителей.
На право действия над объектом возможно создание спец группы (админы, могут редактировать, могут видеть) если существующие группы не устраивают.
Список доступных групп для объекта на определенные действия.
Выбор групп — не иерархия.
Смена прав родителей — может поменять права детей.
Права — сохраняются в таблице, и кэшируются в памяти. Структура, оптимизированная под быстродействие.

<<TableOfContents()>>

== ACL ==

=== Права на объект ===

    1. Права на объект выделяются на группу и операцию. Группы не зависят друг
       от друга и не образуют некой неявной (захардкоженой или следующей из
       некой заранее определённой логики приложения) иерархии, хотя и могут
       явно быть подгруппами друг друга. ~-Последнее фактически означает, что
       пользователи, входящие в группу ''B'', одновременно автоматически входят
       в группу ''A'', которая является родительствой для группы ''B''.-~

    2. Права состоят из следующих битовых масок, по биту на операцию:
        * ''r_mask'' — пользовательские, пользовательские права, которые
        пользователь сам ручками установил на объект,
        * ''e_mask'' — эффективные права, которые сама система определила
        исходя из своих собственных внутренних факторов (описаны ниже) на
        основе ''r_mask''.
    
    3. Таблица ACL связывает объект с группой по маске прав, то есть составляет такую таблицу:
       || '''object_id''' || id объекта, на который выделены права       ||
       || '''group_id'''  || id группы пользователей, которой даны права ||
       || '''u_mask'''    || маска пользовательских прав                 ||
       || '''e_mask'''    || маска эффективных прав                      ||

Права на объект проверяются всегда по ''e_mask'', пользователь же при правке
объекта видит только права по ''u_mask''.

Пользовательские права выставляются самим пользователем в момент создания или
изменения конкретного объекта. Именно они являются __прямым желанием
пользователя__ по права объекта.

Эффективные права устанавливаются самой системой при изменении прав контейнера
данного объекта с применением побитового ''и'' с реальной маской каждого
элемента контейнера. Они являются теми правами, которые __система реально
выдала__ на объект.

    Например есть блог и посты в нём с такими правами (эффективные и
    пользовательские равны, т.к. только что установлены):

        * Блог — видеть могут все,
            * Пост 1 — видеть могут только друзья,
            * Пост 2 — видеть могут все.

    Теперь предположим, что владелец изменил права блога на видимость только
    для друзей. Полчаем следующую картину:

        * Блог — видеть могут только друзья,
            * Пост 1 — видеть могут только друзья,
            * Пост 2 — видеть могут только друзья (пользовательские права —
            видеть могут все).

    Если теперь юзер вернёт права на блог для всех, то будет такая картина:

        * Блог — видеть могут все,
            * Пост 1 — видеть могут только друзья,
            * Пост 2 — видеть могут все (пользовательские права → эффективные
            права).

Таким образом в эффективных правах хранятся права, которые
    1. выставились системой с учётом прав на контейнер (и, возможно, каких-либо
       иных соображений системы);
    2. будут использоваться системой везде, где нужно определить права
       пользователя на совершение данной операции над объектом,
    3. будут кешироваться в различных подсистемах (по мере необходимости).

Пользовательские права
    1. видны пользователю в настройках объекта, как те, что он сам назначил;
    2. используются как своеобразный «бекап» при «восстановлении» прав на
       объект;
    3. используются как база для сравнения с явными желаниями пользователя.

<<Anchor(idea1)>>[[#idea1]] В самом интерфейсе изменения прав на объект можно
выделять (например цветом) те группы, права на которые изменены в эффективной
маске, чтобы юзер мог явно их разрешить для этого объекта в обход родительских
прав.


